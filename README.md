# system_modeling

`model.py` - файл з імлементацією логіки симуляції балансера
`sample_balancer.py` - файл з ініціацією структури, в якій ми будемо симулювати його поведінку

# Об’єкт моделювання
В якості об’єкта моделювання був обраний хмарний балансувальник навантаження. Його задача - бути вхідною точкою в інфраструктуру наших веб застосунків і виступати в якості маршрутизатора на різні вузли обробки запитів. Також в його обов’язки входить перевіряти вузли на дієздатність з заданим інтервалом (Health Check). 
Клієнт може обирати чи використовувати балансування “По колу”, або “липкий сеанс”.

# Структура моделі
```
Запит : {
	Шлях запиту (str),
	Метод запиту (ENUM - [GET, POST]),
	ключ сесії (str),
	Використовувати “липкий сеанс” (Optional[bool])
}
Конфігурація вузлу обробки запиту : {
	Набір конфігурацій обробки - [{
		Шлях - (str),
		Метод - (ENUM - [GET, POST]),
		Розподіл часу обробки - (Назва та параметри)
    }],
    Час обробки не існуючого шляху - (int),
    Розподіл часу поломки вузла - (Назва та параметри),
    Розподіл часу ініціювання процесу - (Назва та параметри)
}
Балансувальник: {
	Набір цільових груп - [{
		Паттерн шляху - (regex str),
		Конфігурація вузлу обробки запиту,
		Кількість вузлів - (int),
		Health check path - (str),
		Очікуваний код відповіді на Health check - (int)
	}],
	Timeout - (int),
	Health Check interval - (int)
}
```
# Алгоритм обслуговування
Система ініціюється за заданою конфігурацією балансувальника. Балансувальник має інформацію про всі вузли обробки і за заданим інтервалом надсилає на заданий шлях запит і перевіряє чи відповів вузол задовільним кодом. Якщо код є неочікуваним або відбувається timeout - цей вузол видаляється і ініціюється новий вузол з такою самою конфігурацією. При цьому Health Check не надсилається допоки не пройде час ініціювання.
При відправці запиту балансер розпізнає за регулярним виразом на яку групу вузлів відправити запит. Якщо запит не підходить нікуди - відповідаємо 502.
Далі маємо список з вузлів і вказівник на останній вузол, на який відправляли запит. Якщо не стоїть флаг на “липкий сенс”, тоді відправляємо запит на чергу наступного вузла в списку після вказівника (Або на 0 вузол, якщо вказівник на останньому).
Якщо цей флаг стоїть, то дивимось в локальний кеш сесій. 
Якщо такого ключа немає - робимо те саме що і в випадку коли флага немає, але записуємо номер вузла в кеш.
Коли цей ключ є - відправляємо запит на вузол що стоїть у значенні.
